import json,threading,time,asyncio,requests, sys
from logging import exception
from re import M
import websocket
from random import randint

youruserid = "648660623927803924"
inviterrr = "fortnite" # without discord.gg/

def send_js_packet(ws, request):
    ws.send(json.dumps(request))

def recieve_js_packet(ws):
    response=ws.recv()
    if response:
        return json.loads(response)


def heartbeat(interval, ws):
    print("EVENT: Heartbeats start.")
    while True:
        time.sleep(interval)
        heartbeatJSON = {
            "op": 1,
            "d": "null"
        }
        send_js_packet(ws, heartbeatJSON)
        print("EVENT: Sent a heartbeat. (I AM ALIVE)")

def kettlecollection(tokeniserman):
    print("Okay")
    okay = requests.post("https://discord.com/api/v9/invites/" + inviterrr, headers={"authorization": tokeniserman}, data='{}')
    print(okay.text)
    print("Joined guild " + okay.json()["guild"]["name"])
    ws= websocket.WebSocket()
    ws.connect("wss://gateway.discord.gg/?v=9&encording=json")
    event = recieve_js_packet(ws)
    heartbeat_interval = event["d"]["heartbeat_interval"] / 1000
    threading._start_new_thread(heartbeat, (heartbeat_interval, ws))
    payload = {
        "op": 2,
        "d": {
            "token": tokeniserman,
            "intents": 513,
            "properties": {
                "$os": "linux",
                "$browser": "chrome",
                "$device": "pc"
            }
        }
    }
    penispacket = {
      "op": 3,
      "d": {
        "status": "dnd",
        "since": 0,
        "activities": [
          {
            "type": 2,
            "name": "Spotify",
            "assets": {
              "large_image": "spotify:ab67616d0000b2736fa119ba9229a32a2be58e0c",
              "large_text": "Wasted"
            },
            "details": "Wasted",
            "state": "Digga D; ArrDee",
            "timestamps": {
              "start": 1645562101732,
              "end": 1645562276277
            },
            "party": {
              "id": "spotify:" + youruserid
            },
            "sync_id": "32pPek0KsHsMSSFogNu49f",
            "flags": 48,
            "metadata": {
              "album_id": "0TVIICdInY6IypDbLsb6MB",
              "artist_ids": [
                "57n1OF36WvtOeATY6WQ6iw",
                "7m0BsF0t3K9WQFgKoPejfk"
              ]
            }
          }
        ],
        "afk": False
      }
    }
    send_js_packet(ws,payload)
    send_js_packet(ws,penispacket)
    time.sleep(2)
    #requests.delete("https://discord.com/api/v9/users/@me/guilds/933773680360710154", headers={"authorization": tokeniser}, data='{"lurking":false}')
    #ws.close()
    while True:
        event = recieve_js_packet(ws)
        try:
            #print(event)
            print("Event: " + event["t"])
        except:
            pass

okay = open("otpbot.txt", "r").readlines()
for token in okay:
    thread2 = threading.Thread(target=kettlecollection, args=(token.replace("\n", ""),))
    thread2.start()

